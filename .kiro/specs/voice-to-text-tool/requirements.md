# 需求文档

## 简介

本系统是一个实时流式语音转文字工具，使用阿里的 FunASR 服务，运行在 macOS（Intel 芯片）系统上。用户通过快捷键激活和关闭工具，在任何输入框中实现语音输入功能。

## 术语表

- **语音转文字工具（Voice-to-Text Tool）**: 本系统的主要应用程序，负责捕获语音并转换为文字
- **FunASR**: 阿里巴巴开发的语音识别服务
- **激活快捷键（Activation Hotkey）**: 用户按下以启动语音识别的键盘组合键
- **关闭快捷键（Deactivation Hotkey）**: 用户按下以停止语音识别的键盘组合键
- **活动输入框（Active Input Field）**: 当前获得焦点的文本输入区域
- **实时流式识别（Real-time Streaming Recognition）**: 在用户说话的同时持续转换语音为文字的过程

## 需求

### 需求 1

**用户故事:** 作为用户，我想通过快捷键激活语音转文字功能，以便在任何输入框中快速开始语音输入

#### 验收标准

1. WHEN 用户按下激活快捷键 THEN 语音转文字工具 SHALL 开始捕获麦克风音频
2. WHEN 语音转文字工具启动 THEN 语音转文字工具 SHALL 显示视觉反馈指示工具正在运行
3. WHEN 激活快捷键被按下且没有活动输入框 THEN 语音转文字工具 SHALL 显示错误提示并保持非活动状态
4. WHEN 语音转文字工具已经在运行中 THEN 语音转文字工具 SHALL 忽略重复的激活快捷键按下

### 需求 2

**用户故事:** 作为用户，我想实时看到我说的话被转换成文字，以便确认识别的准确性

#### 验收标准

1. WHEN 用户说话且语音转文字工具处于活动状态 THEN 语音转文字工具 SHALL 将音频流发送到 FunASR 服务
2. WHEN FunASR 服务返回识别结果 THEN 语音转文字工具 SHALL 将文字插入到活动输入框的当前光标位置
3. WHEN 识别结果是部分结果 THEN 语音转文字工具 SHALL 实时更新显示的文字内容
4. WHEN 识别结果是最终结果 THEN 语音转文字工具 SHALL 确认文字并准备接收下一段语音
5. WHEN 网络连接失败 THEN 语音转文字工具 SHALL 显示错误消息并停止识别

### 需求 3

**用户故事:** 作为用户，我想通过快捷键关闭语音转文字功能，以便控制何时停止语音输入

#### 验收标准

1. WHEN 用户按下关闭快捷键且语音转文字工具处于活动状态 THEN 语音转文字工具 SHALL 停止捕获音频
2. WHEN 语音转文字工具停止 THEN 语音转文字工具 SHALL 关闭与 FunASR 服务的连接
3. WHEN 语音转文字工具停止 THEN 语音转文字工具 SHALL 隐藏视觉反馈界面
4. WHEN 关闭快捷键被按下且语音转文字工具未运行 THEN 语音转文字工具 SHALL 不执行任何操作

### 需求 4

**用户故事:** 作为用户，我想工具能在 macOS Intel 芯片的电脑上稳定运行，以便在我的设备上使用

#### 验收标准

1. THE 语音转文字工具 SHALL 在 macOS 系统（Intel 芯片）上运行
2. WHEN 语音转文字工具启动 THEN 语音转文字工具 SHALL 请求麦克风访问权限
3. WHEN 用户拒绝麦克风权限 THEN 语音转文字工具 SHALL 显示权限说明并无法激活
4. THE 语音转文字工具 SHALL 使用系统默认麦克风作为音频输入设备

### 需求 5

**用户故事:** 作为用户，我想工具界面简单简洁，以便不干扰我的正常工作流程

#### 验收标准

1. WHEN 语音转文字工具未激活 THEN 语音转文字工具 SHALL 不显示任何界面元素
2. WHEN 语音转文字工具激活 THEN 语音转文字工具 SHALL 仅显示最小化的状态指示器
3. THE 语音转文字工具 SHALL 不包含复杂的配置界面或多余功能
4. WHEN 显示状态指示器 THEN 语音转文字工具 SHALL 确保指示器不遮挡用户的输入框

### 需求 6

**用户故事:** 作为用户，我想工具能正确处理各种音频输入情况，以便获得可靠的识别结果

#### 验收标准

1. WHEN 用户说话音量过低 THEN 语音转文字工具 SHALL 继续尝试识别而不报错
2. WHEN 环境中有背景噪音 THEN 语音转文字工具 SHALL 将音频发送到 FunASR 进行处理
3. WHEN 用户长时间不说话 THEN 语音转文字工具 SHALL 保持活动状态直到用户按下关闭快捷键
4. WHEN 音频流中断 THEN 语音转文字工具 SHALL 尝试重新建立连接或通知用户
