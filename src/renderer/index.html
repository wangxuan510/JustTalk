<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Voice to Text - Status Indicator</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: transparent;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      width: 60px;
      height: 60px;
      -webkit-app-region: no-drag;
    }

    .siri-container {
      position: relative;
      width: 60px;
      height: 60px;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 2px;
      background: transparent;
    }

    /* Siri 波形条 */
    .bar {
      width: 3px;
      height: 8px;
      background: linear-gradient(180deg, 
        rgba(0, 122, 255, 1) 0%,
        rgba(88, 86, 214, 1) 50%,
        rgba(255, 45, 85, 1) 100%);
      border-radius: 1.5px;
      box-shadow: 0 0 8px rgba(0, 122, 255, 0.5);
      transition: height 0.05s ease-out;
    }

    /* 监听状态 */
    .listening .bar {
      background: linear-gradient(180deg, 
        rgba(0, 122, 255, 1) 0%,
        rgba(88, 86, 214, 1) 50%,
        rgba(255, 45, 85, 1) 100%);
      box-shadow: 0 0 10px rgba(0, 122, 255, 0.5);
    }

    /* 处理状态 */
    .processing .bar {
      background: linear-gradient(180deg, 
        rgba(52, 199, 89, 1) 0%,
        rgba(48, 209, 88, 1) 50%,
        rgba(50, 215, 75, 1) 100%);
      box-shadow: 0 0 10px rgba(52, 199, 89, 0.5);
    }

    /* 错误状态 */
    .error .bar {
      background: linear-gradient(180deg, 
        rgba(255, 59, 48, 1) 0%,
        rgba(255, 69, 58, 1) 50%,
        rgba(255, 79, 68, 1) 100%);
      box-shadow: 0 0 10px rgba(255, 59, 48, 0.5);
      animation: shake 0.5s;
    }

    @keyframes shake {
      0%, 100% {
        transform: translateX(0);
      }
      25% {
        transform: translateX(-3px);
      }
      75% {
        transform: translateX(3px);
      }
    }
  </style>
</head>
<body>
  <div id="indicator" class="siri-container listening">
    <div class="bar"></div>
    <div class="bar"></div>
    <div class="bar"></div>
    <div class="bar"></div>
    <div class="bar"></div>
    <div class="bar"></div>
    <div class="bar"></div>
    <div class="bar"></div>
    <div class="bar"></div>
    <div class="bar"></div>
  </div>
  <script>
    const { ipcRenderer } = require('electron');

    const indicator = document.getElementById('indicator');
    const bars = document.querySelectorAll('.bar');
    
    // 每个条的随机因子，用于创建波形效果
    const barFactors = Array.from({ length: 10 }, (_, i) => {
      // 中间的条更高，两边的条更低
      const center = 5;
      const distance = Math.abs(i - center);
      return 1 - (distance * 0.15);
    });

    // 监听状态更新
    ipcRenderer.on('update-status', (event, status) => {
      // 移除所有状态类
      indicator.className = 'siri-container';
      
      // 添加新状态类
      indicator.className = `siri-container ${status}`;
    });

    // 监听音量更新
    ipcRenderer.on('update-volume', (event, volume) => {
      // 根据音量更新每个条的高度
      bars.forEach((bar, index) => {
        // 基础高度 8px，最大高度 45px（适配更小的窗口）
        const minHeight = 8;
        const maxHeight = 45;
        
        // 应用音量和条的因子
        const factor = barFactors[index];
        const height = minHeight + (maxHeight - minHeight) * volume * factor;
        
        // 添加一些随机抖动，使波形更自然
        const jitter = (Math.random() - 0.5) * 4 * volume;
        const finalHeight = Math.max(minHeight, Math.min(maxHeight, height + jitter));
        
        bar.style.height = `${finalHeight}px`;
      });
    });
  </script>
</body>
</html>
